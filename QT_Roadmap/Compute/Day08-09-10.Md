# Network Security Groups
* Network security groups are attached to nic and they have allow or deny rules

![VM_nic_Level](../Images_Azure/azcompute36.webp)


## Virtual Machine Creation
  * Required:
       * Resource Group
       * Virtual Network and subnet
       * Network security group
       * Network interface
       * Virtual machine


# Azure CLI :  Day01

 * Azure CLI is a command line way of interacting with azure
 * Installation: [Refer Here](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest)
 * [Refer Here](https://www.youtube.com/watch?v=9guzVbZPGuw&t=3s) for installation.
 * How to find cli commmands
     * Navigate to [Refer Here](https://learn.microsoft.com/en-us/cli/azure/?view=azure-cli-latest)
     * And click on reference
        
        ![CLI_Referneces](../Images_Azure/azcompute37.webp)

 * Ensure Azure CLI Extension is installed in visual studio code
      ![CLI_Extentions_Done](../Images_Azure/azcompute38.webp)

     * refer to classroom video on how to build cli
     * The cli developed in the session



# Creating the Resources thrugh CLI:

# login
# az login

# create a resource group
az group create --location "eastus" --name "vmfromcli"

# Create a network 
az network vnet create --name "vmnet" --resource-group "vmfromcli"

# Create a subnet
az network vnet subnet create `
    --name "web" `
    --resource-group "vmfromcli" `
    --vnet-name "vmnet" `
    --address-prefixes "10.0.0.0/24"

# Create a network security group

az network nsg create `
    --name "webnsg" `
    --resource-group "vmfromcli" `
    --location "eastus" 

# Create a rule to open 80 port to every one
az network nsg rule create `
    --name "openhttp" `
    --resource-group "vmfromcli" `
    --nsg-name "webnsg" `
    --priority 1000 `
    --access Allow `
    --source-address-prefixes "*" `
    --destination-address-prefixes "*" `
    --destination-port-ranges "80" `
    --source-port-ranges "*" `
    --direction "Inbound" `
    --protocol "Tcp"

# Create a rule to open 22 port to every one
az network nsg rule create `
    --name "openssh" `
    --resource-group "vmfromcli" `
    --nsg-name "webnsg" `
    --priority 1100 `
    --access Allow `
    --source-address-prefixes "*" `
    --destination-address-prefixes "*" `
    --destination-port-ranges "22" `
    --source-port-ranges "*" `
    --direction "Inbound" `
    --protocol "Tcp"

# Create a nic with only private ip attached to web subnet with webnsg
az network nic create `
    --name "webnic" `
    --resource-group "vmfromcli" `
    --location "eastus" `
    --vnet-name "vmnet" `
    --subnet "web" `
    --network-security-group "webnsg"

# Create a vm
az vm create `
    --name "webvm" `
    --resource-group "vmfromcli" `
    --location "eastus" `
    --admin-password "azurevmfromcli@123" `
    --admin-username "dell" `
    --nics "webnic" `
    --image "Ubuntu2204"

## Exercise: Create the same with public ip.



# Azure CLI Contineous: Day02

 * Create a reusable script to create virtual machines
 * We have create a script with variables [Refer Here](https://github.com/asquarezone/azurescripts/commit/9ff861f3a45d52e12f2e3d7f33553bc81f1b0f7a?diff=split)
 * To make this script reusable we have to deal with
     * not trying to create resources if they are already present
     * giving options to the users to change the values
 * References:
     * Bash cheatsheet [Refer Here](https://devhints.io/bash)
     * Azure CLI Bash [Refer Here](https://learn.microsoft.com/en-us/cli/azure/use-azure-cli-successfully-bash?view=azure-cli-latest)
 * [Refer Here](https://github.com/asquarezone/azurescripts/commit/69924dc62aa43079b79db2ae7f7c5ad271b22e24?diff=split) for the gaurds or flags added to create resource group, network and subnet only if they donot exists
 * Exercise: Apply the same for other resoruces


# Azure CLI Contineous: Day03
  * Making CLI create resources only if they donot exist
  * [Refer Here](https://github.com/asquarezone/azurescripts/commit/48a83f3c916341a4fd0fd4da4c8d6fc4164ee941?diff=split) for changes
  * Create positional parameters for [Refer Here](https://github.com/asquarezone/azurescripts/blob/master/Nov23/AzureCLI/VM/azurevm.sh)
  * [Refer Here](https://github.com/asquarezone/azurescripts/commit/1358bdecffb82fec070801abf690fec75a9c6494?diff=split) for the changes done to use keyword arguments